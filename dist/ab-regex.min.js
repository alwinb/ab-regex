(()=>{var k=(t,e)=>()=>(e||(e={exports:{}},t(e.exports,e)),e.exports);var je=k((Xn,Ee)=>{var Un=console.log.bind(console),ne=1,re=511,xt=~re,wt=(...t)=>(e,...n)=>[String.raw(...t).replace(/\s+/g,""),ne++<<9|e,...n],bt=()=>["",ne++<<9],Ot=()=>ne++<<9,Rt=(t={},e=0)=>new Proxy({},{get:(n,r)=>t[r]||(t[r]=1<<e++)}),Ce={},{START:M,END:L,SKIP:oe,LEAF:_,ASSOC:G,INFIX:se,PREFIX:F,POSTFIX:ie,GROUP:T}=Rt(Ce),St=t=>(...e)=>[String.raw(...e).replace(/\s+/g,""),t],[Pt,kt,At,Et,Ct,Nt,$t]=[M,_,F,se,G,ie,L].map(St);function Ne(t){let e="",n=[],r=new RegExp(t.map(([o,c,...l])=>(n.push({type:c,info:l}),`(${o})`)).join("|"),"ys");r.infos=n,Object.defineProperty(r,"next",{value:s});function s(o,c){this.lastIndex=c;let l=this.exec(o);if(!l)return null;let i=1;for(;l[i]==null;)i++;let{type:u,info:d}=n[i-1];return[u,l[i],...d]}return r}function jt(t){let e={},n={};for(let r in t){let s=t[r],{types:o,lexer:c}=It(r,s,t);e[r]=c,n[r]=o}return{lexers:e,types:n}}function It(t,e,n){let{end:r,skip:s={},sig:o=[]}=e,c=[],l=[],i={};for(let g in s){let O=s[g];c.push([O,oe]),l.push([O,oe])}l.push([r[0],L]);for(let g=0,O=o.length;g<O;g++)for(let b in o[g]){let w=o[g][b],y=Ot(),p=0;if(typeof w[0]=="number"){let[a,f,h,v]=w;i[b]=y|a|T,p=[f,y|M|a,g,h]}else{let[a,f]=w;i[b]=y|=f,p=[a,y],y&_||(p[2]=g)}p[1]&(F|_)?c.push(p):l.push(p)}let u=t,d=Ne(c),m=Ne(l);return{name:u,types:i,lexer:{name:u,Before:d,After:m}}}var N=Symbol("PRE "),$e=Symbol("POST");function _t(t,e,n,r=(...s)=>s){let s,o,c,l,i,u,d,m;return this.parse=b,this;function g(w){let y=new ce(e,t[e[3]]);return s=[y],l=0,i=1,u=0,c=w,o=null,d=y.lexer,m=N,y}function O(){let w=m===N?d.Before:d.After,y=w.next(c,l);if(y==null){if(l<c.length&&w.lastIndex<l||m===N)throw new qt(c,l,i,u);return n}else y[1]===`
`&&(i++,u=l+1);return l=w.lastIndex,y}function b(w){for(let y,{ops:p,builds:a}=g(w);;){let f=y||O(),h=y?y[0][0]:f[0],v=h&(_|M|oe)?-1:p.length-1;for(;v>=0;v--){let x=p[v],j=typeof x[0]=="number"?x:x[0];if(!(h&L||Mt(j,f)))break;p.length--;let q=j[3],te=a.length-q;j.length=2,a[te]=j[0]&T?r(...x.concat(a.splice(te,q))):r(x,...a.splice(te,q))}if(h&L){if(y=s.pop().collapse(f),s.length)({ops:p,builds:a,lexer:d}=s[s.length-1]);else return r(...y);continue}if(h&M){let x=new ce(f,t[f[3]]);({ops:p,builds:a,lexer:d}=s[s.length]=x),m=N}else if(h&_)a[a.length]=y?r(...y):r(f),m=$e;else if(p.length&&h&G&&f[0]===p[p.length-1][0])p[p.length-1][3]++,m=N;else if(h&(F|se|G)){p[p.length]=f;let x=h&T?f[0]:f;x[3]=x[0]&F?1:2,m=N}else if(h&ie){let x=a.length-1;h&T?(f[0].length=2,a[x]=r(...f,a[x])):(f.length=2,a[x]=r(f,a[x])),m=$e}y=null}}}var Ie=/([^\n]{0,80})/ys;function qt(t,e,n,r){let s=Math.max(r,e-80);Ie.lastIndex=r;let o=Ie.exec(t)[1];return new SyntaxError(`Invalid expression. At line ${n}:${e-r}:

		${o}
		${"^".padStart(e-r+1)}`)}function Mt(t,e){let n=t[2],r=e[2];return n>r?!0:!!(n===r&&n[0]&re===ie)}var ce=class{constructor(e,n){this.opener=e,this.lexer=n,this.ops=[],this.builds=[]}collapse(e){let[n,r,s]=this.opener,o=n&F?1:n&se|G?2:0,c=[n&~M|T,r+e[1]];return o&&c.push(s,o),[c,this.builds[0]]}};Ee.exports={compile:jt,Parser:_t,Roles:Ce,token:wt,tokenType:bt,roleMask:re,typeMask:xt,start:Pt,atom:kt,prefix:At,infix:Et,assoc:Ct,postfix:Nt,end:$t}});var fe=k((er,qe)=>{var zn=console.log.bind(console),Y=je(),{token:Jn,tokenType:Zn,start:Hn,atom:S,prefix:Ft,infix:Kn,postfix:U,assoc:D,end:le}=Y,{LEAF:ue,PREFIX:Wn,INFIX:Qn,POSTFIX:Vn}=Y.Roles,{raw:Me}=String,Tt={space:Me`[\t\f\x20]+`,newline:Me`[\n]`},Dt={name:"Regex",skip:Tt,end:le`[)]`,sig:[{any:S`[.]`,top:S`[⊤]`,bottom:S`[⊥]`,empty:S`[ε]`,step:S`[a-zA-Z0-9]`,string:[ue,'["]',"Chars",'["]'],range:[ue,"[[]","RangeSet","]"],group:[ue,"[(]","Regex","[)]"]},{and:D`[&]`},{or:D`[|]`},{conc:D`.{0}(?=[!a-zA-Z0-9."[(⊤⊥ε\t\f\x20\n])`},{not:Ft`[!]`},{star:U`[*]`,opt:U`[?]`,plus:U`[+]`,repeat:U`<\d+(?:-(?:\d+|[*]))?>`}]},Bt={name:"Chars",end:le`["]`,sig:[{chars:S`[^\x00-\x19\\"]`,esc:S`[\\]["/\\bfnrt]`,hexesc:S`[\\]u[a-fA-F0-9]{4}`,empty:S`.{0}(?=")`},{strcat:D`.{0}(?!")`}]},Lt={name:"RangeSet",end:le`]`,sig:[{range:S`[^\x00-\x19\]]-[^\x00-\x19\]]`,char:S`[^\x00-\x19\]]`,empty:S`.{0}(?=\])`},{rnor:D`.{0}(?!\])`}]},{lexers:ae,types:_e}=Y.compile({Regex:Dt,Chars:Bt,RangeSet:Lt}),Fe={},pe=_e;for(let t in pe)for(let e in pe[t])Fe[pe[t][e]]=e;function Gt(t,e){let n=e==null?Te:(...c)=>(c=Te(...c),e(...c)),r=ae.Regex.Before.next("("),s=ae.Regex.After.next(")");return new Y.Parser(ae,r,s,n).parse(t)}var Yt={b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},R=_e;function Te(...t){let[e,n,r]=t,[s,o]=e;return t[0]=Fe[s],s===R.Regex.group?["group",n]:s===R.Regex.step?["step",o]:s===R.Regex.range?["group",n]:s===R.Regex.repeat?Ut(o,n):s===R.Regex.star?["repeat",n,0,Infinity]:s===R.Regex.plus?["repeat",n,1,Infinity]:s===R.Regex.opt?["repeat",n,0,1]:s===R.Regex.string?["group",n]:s===R.Chars.empty?["empty"]:s===R.Chars.chars?["step",o]:s===R.Chars.esc?["step",Yt[o[1]]||o[1]]:s===R.Chars.hexesc?["step",String.fromCodePoint(parseInt(o.substr(2),16))]:s===R.Chars.strcat?["conc",...t.slice(1)]:s===R.RangeSet.empty?["empty"]:s===R.RangeSet.range?["range",o[0],o[2]]:s===R.RangeSet.char?["step",o]:s===R.RangeSet.rnor?["or",...t.slice(1)]:t}function Ut(t,e){let[n,r]=t.substr(1,t.length-2).split("-");return n=Math.max(+n,0),r=r==null?n:r==="*"?Infinity:+r,["repeat",e,n,r]}qe.exports={parse:Gt}});var J=k((nr,De)=>{var tr=console.log.bind(console),Xt=t=>JSON.stringify(t,null,2),Be={TOP:"top",BOT:"bottom",EMPTY:"empty",STEP:"step",ANY:"any",RANGE:"range",GROUP:"group",REPEAT:"repeat",STAR:"star",OPT:"opt",PLUS:"plus",NOT:"not",AND:"and",OR:"or",CONC:"conc"},{TOP:he,BOT:de,EMPTY:me,STEP:ge,ANY:ye,RANGE:ve,GROUP:zt,REPEAT:X,NOT:Jt,AND:Zt,OR:Ht,CONC:Kt,ORS:Wt,CONCS:Qt}=Be,E=(t,e)=>t<e?-1:t>e?1:0,Vt=t=>(e,n)=>{let r=E(e.length,n.length),s=1;for(let o=1;!r&&o<e.length;o++)r=r||t(e[o],n[o]);return r},z=class{static fmap(e){return n=>{let[r,...s]=n;return r===ge||r===ye||r===ve||r===me||r===he||r===de?n:r===X?[r,e(s[0]),s[1],s[2]]:[r,...s.map(e)]}}static compareNode(e){return(n,r)=>{let s=n[0],o=r[0];return z.compareOperator(s,o)||s===ge&&0||E(n[1],r[1])||s===ve&&0||E(n[1],r[1])||E(n[2],r[2])||s===X&&0||e(n[1],r[1])||E(n[2],r[2])||E(n[3],r[3])||Vt(e)(n,r)}}static compareOperator(e,n){return E(e,n)}static fromObject(e){return(n,...r)=>{try{return n===de?e.bottom:n===he?e.top:n===me?e.empty:n===ye?e.any:e[n](...r)}catch(s){let o=`Error in ${e.constructor.name}.apply`;throw console.log(o),console.log(`Calling ${Xt(n)} on `,r,"in Algebra"),console.log(e.constructor.name,e[Symbol.iterator]?[...e]:e),new Error(o)}}}static fromFunction(e){return{bottom:e(de),top:e(he),empty:e(me),any:e(ye),step:n=>e(ge,n),range:(n,r)=>e(ve,n,r),group:n=>e(zt,n),repeat:(n,r,s)=>e(X,n,r,s),star:n=>e(X,n,0,Infinity),plus:n=>e(PLUS,n),opt:n=>e(OPT,n),not:n=>e(Jt,n),and:(n,r)=>e(Zt,n,r),or:(...n)=>e(Ht,...n),conc:(...n)=>e(Kt,...n),ors:(...n)=>e(Wt,...n),concs:(...n)=>e(Qt,...n)}}};De.exports={cmpJs:E,Operators:Be,Algebra:z}});var be=k((or,Le)=>{var en=(t,e)=>t<e?-1:t>e?1:0,[rr,tn]=[-1,1],xe=A(null,null,0,null,null),we=class{constructor(e=en,n=xe){if(typeof e!="function")throw new Error("First argument to AATree must be a comparison function.");this.compare=e,this.store=n}lookup(e){return this.select(e)}select(e){let{compare:n}=this,r=this.store,s=null;for(;r.level;){let o=n(e,r.key);if(s={branch:o,node:r,parent:s},o===0)return new Ge(this,s,r.key);r=o<0?r.l:r.r}return new Ge(this,s,e)}insert(...e){let n=this,r=e.length;for(let s=0;s<r;s+=2)n=n.lookup(e[s]).set(e[s+1]);return n}};function Ge({compare:t},e,n){let r=e!=null&&e.branch===0;this.found=r,this.key=r?e.node.key:n,this.value=r?e.node.value:void 0,this.set=s=>new we(t,nn(e,n,s))}function A(t,e,n,r,s){return{l:r,level:n,key:t,value:e,r:s}}function rn(t){let{l:e,level:n}=t;return n&&n===e.level?A(e.key,e.value,e.level,e.l,A(t.key,t.value,n,e.r,t.r)):t}function on(t){let{level:e,r:n}=t;return t.level&&t.level===n.r.level?A(n.key,n.value,n.level+1,A(t.key,t.value,t.level,t.l,n.l),n.r):t}function nn(t,e,n){let r,s;for(t!==null&&t.branch===0?(r=t.node,s=A(e,n,r.level,r.l,r.r),t=t.parent):s=A(e,n,1,xe,xe);t!==null;)r=t.node,s=t.branch===tn?A(r.key,r.value,r.level,r.l,s):A(r.key,r.value,r.level,s,r.r),s=on(rn(s)),t=t.parent;return s}Le.exports=we});var Ze=k((cr,Ye)=>{var sn=be(),{Algebra:Oe,Operators:cn}=J(),sr=console.log.bind(console),Z=(t,e)=>t<e?-1:t>e?1:0,{TOP:ln,BOT:un,EMPTY:an,STEP:pn,ANY:fn,RANGE:hn,GROUP:dn,REPEAT:$,NOT:Ue,AND:mn,OR:H,CONC:K,ORS:Xe,CONCS:ze}=cn;function Re(t,e){return gn(t,t(e))}function gn(t,[e,...n]){let[r,s]=n,o=c=>Re(t,c);return e===pn?r:e===fn?".":e===hn?`[${r}-${s}]`:e===an?"\u03B5":e===ln?"\u22A4":e===un?"\u22A5":e===dn?`(${o(r)})`:e===Ue?`(!${o(r)})`:e===$?`(${o(r)}${yn(n[1],n[2])})`:e===mn?`(${n.map(o).join(" & ")})`:e===H?`(${n.map(o).join(" | ")})`:e===K?`(${n.map(o).join("")})`:e===Xe?`(${n.map(o).join(" | ")})`:e===ze?`(${n.map(o).join("")})`:""}function yn(t,e){return t===0&&e===Infinity?"*":t===1&&e===Infinity?"+":t===0&&e===1?"?":e===Infinity?`<${t}-*>`:`<${t}-${e}>`}function Je(){let t=r=>this._heap[r],e=(...r)=>{let s=this._memo.select(r);if(s.found)return s.value;let o=this._heap.push(r)-1;return this._memo=s.set(o),o};this._memo=new sn(Oe.compareNode(Z)),this._heap=[],this.out=t,this.apply=e;function*n(){for(let[r,s]of this._heap.entries())yield[r,Re(t,r),s]}this[Symbol.iterator]=n.bind(this),Object.setPrototypeOf(this,Oe.fromFunction(e))}function vn(t=Z){return{join:(n,r)=>[...e(n,r)]};function*e(n,r){n=n[Symbol.iterator](),r=r[Symbol.iterator]();let s=n.next(),o=r.next();for(;!(s.done&&o.done);){if(s.done){yield o.value,yield*r;return}if(o.done){yield s.value,yield*n;return}let c=t(s.value,o.value);c<0?(yield s.value,s=n.next()):c>0?(yield o.value,o=r.next()):(yield s.value,[s,o]=[n.next(),r.next()])}}}function xn(t){return{join:(n,r)=>[...e(n,r)]};function*e(n,r){let s=0,o=n.length-1;for(;s<o;)yield n[s++];for(yield*t(n[s],r[0]),s=1,o=r.length;s<o;)yield r[s++]}}function wn(t=new Je){let{top:e,bottom:n,empty:r,any:s}=t,o=(l,i)=>l&&i&&l*i,c=vn(Z);return new class{constructor(){this._heap=t._heap,this.compare=Z;for(let i of["and","or","not","conc","repeat"])this[i]=this[i].bind(this);this.top=e,this.bottom=n,this.empty=r,this.any=s,this.apply=Oe.fromObject(this),this.out=t.out.bind(t),this[Symbol.iterator]=t[Symbol.iterator]}step(...i){return t.step(...i)}range(...i){return t.range(...i)}group(i){return i}not(i){let[u,d]=t.out(i);return u===Ue?d:t.not(i)}repeat(i,u,d){let[m,g,O,b]=t.out(i);return d===0?r:u===Infinity?n:u===1&&d===1?i:i===s&&u===0&&d===Infinity?e:i===r?r:i===e?e:i===n?n:m===$?t.repeat(g,o(u,O),o(d,b)):t.repeat(i,u,d)}and(...i){return i.reduce(this.and2.bind(this))}and2(i,u){return i===u?i:i===n||u===n?n:i===e?u:u===e?i[u]=[i,u].sort():t.and(i,u)}or(...i){return i.reduce(this.or2.bind(this))}or2(i,u){let d=this.repeat.bind(this);if(i===e||u===e)return e;if(i===n)return u;if(u===n)return i;if(i===r)return d(u,0,1);if(u===r)return d(i,0,1);let m=b=>{let[w,...y]=t.out(b);return w===H||w===Xe?y:[b]},g=c.join(m(i),m(u));return g.length===1?g[0]:g.length===2?t.apply(H,...g):t.apply(H,...g)}conc(...i){return i.reduce(this.conc2.bind(this))}conc2(i,u){if(i===n||u===n)return n;if(i===r)return u;if(u===r)return i;let d=O=>{let[b,...w]=t.out(O);return b===K||b===ze?w:[O]},m=xn(this._squash.bind(this)).join(d(i),d(u));return m.length===1?m[0]:m.length===2?t.apply(K,...m):t.apply(K,...m)}_squash(i,u){let[d,m,g,O]=t.out(i),[b,w,y,p]=t.out(u);return d===$&&b===$&&m===w?[t.repeat(m,g+y,O+p)]:i===w&&b===$?[t.repeat(i,y+1,p+1)]:d===$&&u===m?[t.repeat(u,g+1,O+1)]:i===u?[t.repeat(i,2,2)]:[i,u]}}}Ye.exports={Shared:Je,Normalised:wn,_print:Re}});var Q=k((ar,He)=>{var lr=console.log.bind(console),[W,Se]=[Symbol("Below"),Symbol("Above")],bn=t=>([e,n],[r,s])=>t(n,s)||(e===r?0:e===W?-1:1),On=t=>(e,[n,r])=>t(e,r)||(n===Se?-1:1);function Rn(t,e,n=cmp){let r=1,s=t.length;for(;r<t.length&&n(e,t[r])>=0;r+=2);return t[r-1]}function*Ke(t,e,n,r=cmp,s=cmp){e=e[Symbol.iterator](),n=n[Symbol.iterator]();let{value:o}=e.next(),{value:c}=n.next(),{value:l,done:i}=e.next(),{value:u,done:d}=n.next(),m=t(o,c);for(;!(i&&d);){let g,[O,b]=!i&&d?[l,-1]:i&&!d?[u,1]:(g=r(l,u))>0?[u,1]:[l,g];b<=0&&({value:o}=e.next(),{value:l,done:i}=e.next()),b>=0&&({value:c}=n.next(),{value:u,done:d}=n.next());let w=t(o,c);s(w,m)!==0&&(yield*[m,O],m=w)}yield m}function*We(t){let e=[],n=t.length-1,r=[-Infinity];for(let s=0;s<n;s+=2){let o=t[s+1];yield{start:r,value:t[s],end:o},r=o}n>=0&&(yield{start:r,value:t[n],end:[Infinity]})}I.above=t=>[Se,t];I.below=t=>[W,t];function I(t,e,{below:n=I.below,above:r=I.above}={}){let s=bn(t),o=On(t);if(typeof t!="function")throw new TypeError("RangeSet class constructor requires compareKey function.");if(typeof e!="function")throw new TypeError("RangeSet class constructor requires compareValue function.");return class{constructor(l){Object.defineProperties(this,{store:{value:Array.from(l),enumerable:!1}})}static mapped(l,i){return new this(Ke(l,i.store,[null],s,e))}static merged(l,i,u){return new this(Ke(l,i.store,u.store,s,e,{below:n,above:r}))}static fromConstant(l){return new this([l])}lookup(l){return Rn(this.store,l,o)}toString(){return this._toString().join("")}*ranges(){yield*We(this.store)}_toString(){let l=[this.store[0]];for(let i=1;i<this.store.length;i+=2)this.store[i][0]===W?l.push(" |",this.store[i][1]," "):l.push(" ",this.store[i][1],"| "),l.push(this.store[i+1]);return l}}}var Sn=(t,e)=>t?e?0:1:e?-1:0;B.above=t=>[Se,t];B.below=t=>[W,t];function B(t,{below:e=B.below,above:n=B.above}={}){if(typeof t!="function")throw new TypeError("RangeSet class constructor requires compareElement function.");class r extends I(t,Sn){static get full(){return new r([!0])}static get empty(){return new r([!1])}static fromElement(o){return new r([!1,e(o),!0,n(o),!1])}static fromRange(o,c){return t(o,c)>0?r.bottom:new r([!1,e(o),!0,n(c),!1])}static uptoBelow(o){return new r([!0,e(o),!1])}static uptoAbove(o){return new r([!0,n(o),!1])}static fromBelow(o){return new r([!1,e(o),!0])}static fromAbove(o){return new r([!1,n(o),!0])}static and(o,c){return this.merged((l,i)=>l&&i,o,c)}static or(o,c){return this.merged((l,i)=>l||i,o,c)}static diff(o,c){return this.merged((l,i)=>l!==i,o,c)}static not(o){return this.mapped(c=>!c,o)}*ranges(){for(let{start:o,end:c,value:l}of We(this.store))l&&(yield{start:o,end:c})}negate(){return r.not(this)}}return r.prototype.top=r.prototype.full,r.prototype.test=r.prototype.lookup,r}He.exports={RangeMap:I,RangeSet:B}});var Ae=k((dr,Qe)=>{var pr=console.log.bind(console),Pn=t=>JSON.stringify(t,null,2),{Algebra:Ve}=J(),{Normalised:et,_print:kn}=Ze(),{RangeMap:tt,RangeSet:nt}=Q(),V=(t,e)=>t<e?-1:t>e?1:0,rt=t=>nt.below(t+1),fr=tt(V,V,{above:rt}),Pe=nt(V,{above:rt}),P={bottom:!1,top:!0,empty:!0,any:!1,step:(...t)=>!1,range:(...t)=>!1,group:(...t)=>t[0],repeat:(t,e,n)=>e===0?!0:t,not:(...t)=>!t[0],or:(...t)=>t.includes(!0),and:(...t)=>!t.includes(!1),conc:(...t)=>!t.includes(!1)},ke=t=>t.codePointAt(0);function ot(t=new et){let e=tt(V,t.compare),n=s=>kn(t.out,s);class r{constructor(o,c,l){this.id=o,this.term=o,this.accepts=c,this.derivs=l}*[Symbol.iterator](){let{id:o,term:c,accepts:l,derivs:i}=this;yield*[o,n(c),l,...e.mapped(n,i).store]}toString(){let{term:o,accepts:c,derivs:l}=this;return[o,n(o),c,`[ ${e.mapped(n,l)} ]`].join(" ")}}return new class{constructor(){this.bottom=new r(t.bottom,P.bottom,e.fromConstant(t.bottom)),this.top=new r(t.top,P.top,e.fromConstant(t.top)),this.empty=new r(t.empty,P.empty,e.fromConstant(t.bottom)),this.any=new r(t.any,P.any,e.fromConstant(t.empty)),this.apply=Ve.fromObject(this),this._heap=t._heap}*[Symbol.iterator](){yield*t._heap}group(o){return o}step(o){return new r(t.step(o),P.step(o),e.mapped(c=>c?t.empty:t.bottom,Pe.fromElement(ke(o))))}range(o,c){return new r(t.range(o,c),P.range(o,c),e.mapped(l=>l?t.empty:t.bottom,Pe.fromRange(ke(o),ke(c))))}not({term:o,accepts:c,derivs:l}){return new r(t.not(o),P.not(c),e.mapped(t.not,l))}repeat({term:o,accepts:c,derivs:l},i,u){let d=t.repeat(o,i,u),m=t.repeat(o,Math.max(i-1,0),Math.max(u-1,0));return new r(d,P.repeat(c,i,u),e.mapped(g=>t.conc(g,m),l))}or(...o){return o.reduce(this.or2.bind(this))}or2(o,c){return new r(t.or(o.term,c.term),P.or(o.accepts,c.accepts),e.merged(t.or,o.derivs,c.derivs))}and(...o){return o.reduce(this.and2.bind(this))}and2(o,c){return new r(t.and(o.term,c.term),P.and(o.accepts,c.accepts),e.merged(t.and,o.derivs,c.derivs))}conc(...o){return o.reduce(this.conc2.bind(this))}conc2(o,c){let l=t.conc(o.term,c.term),i=e.mapped(u=>t.conc(u,c.term),o.derivs);return new r(l,P.conc(o.accepts,c.accepts),o.accepts?e.merged(t.or,i,c.derivs):i)}}}function An(){let t=new ot,e=t._heap,n=[];this.apply=r.bind(this),this._states=n;for(let s of e)n.push(t.apply(...s));this._inspect=function*(){for(let s of n)yield String(s)},this[Symbol.iterator]=function*(){for(let s of n)yield s};function r(...s){try{let o=n.length-1,c=t.apply(...s);for(n[c.id]=c;o<e.length;o++)if(!n[o]){let l=Ve.fmap(u=>n[u])(e[o]),i=t.apply(...l);n[i.id]=i}return c}catch(o){throw console.log(`Error in ${this.constructor.name}.apply`),console.log(`Calling ${Pn(s[0])} on ${s.slice(1)}in Algebra${this.constructor.name}`),console.log(this[Symbol.iterator]?[...this._inspect()]:this),o}}this.run=function(s,o=""){for(let c of o){let l=c.codePointAt(0);if(s===t.bottom.id||s===t.top.id)return n[s];s=n[s].derivs.lookup(l)}return n[s]}}Qe.exports={OneLevel:ot,Compiler:An,Normalised:et,CharSet:Pe}});var ft=k((gr,st)=>{var{parse:En}=fe(),{Algebra:Cn}=J(),{Normalised:Nn,OneLevel:$n}=Ae(),{RangeMap:it}=Q(),In=be(),mr=console.log.bind(console),C=(t,e)=>t<e?-1:t>e?1:0;function*ct(t){yield*t}function*jn(...t){for(let e of t)yield*e}function*qn(t,e,n,r,s,o){s=ct(s),o=ct(o);let c=s.next(),l=o.next();for(;!(c.done&&l.done);){if(l.done){yield e(c.value);for(let u of s)yield e(u);return}if(c.done){yield n(l.value);for(let u of o)yield n(u);return}let i=t(c.value,l.value);i<0?(yield e(c.value),c=s.next()):i>0?(yield n(l.value),l=o.next()):(yield r(c.value,l.value),[c,l]=[s.next(),o.next()])}}var lt=t=>(e,n)=>{let r=jn([C(e.length,n.length)],qn(s=>0,s=>-1,s=>1,t,e,n));for(let s of r)if(s)return s;return 0},Mn=([t,e],[n,r])=>C(t,n)||C(e,r),ut=lt(Mn);function _n(t,e){let n=[],r=new Set;for(let[s,o]of t)o&&!r.has(o)&&(r.add(o),n.push([s,o]));for(let[s,o]of e)o&&!r.has(o)&&(r.add(o),n.push([s,o]));return n.length?n:[[null,0]]}var at=it(C,C),pt=it(C,ut);function Fn(t=new Nn){let e=new $n(t),n=e._heap,r=new In(ut),s=[],o=[];class c{constructor(a,f){this.accepts=a,this.derivs=f}static fromSpec(a){let f=c.from(null,e.bottom);for(let[h,v]of a){let x=c.from(h,u(v));x.id=a,f=f.add(x)}return f}static from(a,{term:f,accepts:h,derivs:v}){return a=f===0?null:a,v=pt.mapped(x=>[[a,x]],v),new c(h?a:null,v)}static merge(a,f){let h=a.accepts==null?f.accepts:a.accepts,v=pt.merged(_n,a.derivs,f.derivs);return new c(h,v)}add(a){return c.merge(this,a)}}function l(p){return o[p]}function i(p){return g(m(p))}function u(p){for(let a=s.length;a<=p;a=s.length){let f=Cn.fmap(v=>s[v])(n[a]),h=e.apply(...f);delete h.id,s[h.term]=h}return s[p]}function d(p){let a=r.select(p);if(a.found)return a.value.id;let f=c.fromSpec(p),h=o.push(f)-1;return f.id=h,r=a.set(f),h}function m(p){let a=[],f=new Set;for(let h in p){let v=En(p[h],t.apply);f.has(v)||(f.add(v),a.push([h,v]))}return a}function g(p){let a=d(p),f=o[a];f.derivs=at.mapped(d,f.derivs);for(let h=a+1;h<o.length;h++){let v=o[h];v.derivs=at.mapped(d,v.derivs)}return a}function O(p,a=0,f=1){let h=o[f],v=h.accepts!=null?[h.accepts,a,a]:null,x=a;for(let q=p.length;x<q;x++)f=h.derivs.lookup(p.charCodeAt(x)),h=o[f],h.accepts!=null&&(v=[h.accepts,a,x+1]);return{token:v?[v[0],p.substring(v[1],v[2])]:null,pos:v?v[2]:x,pos_:x}}function b(){}function*w(){for(let p of o)yield[p.id,p.accepts,String(p.derivs)]}let y=g([[null,0]]);Object.assign(this,{fail:y,states:o,compile:i,get:l,run:O,_inspect:w})}st.exports={Compiler:Fn,compare:C,compareArray:lt}});var yt=k((vr,ht)=>{var{parse:Tn}=fe(),{TermStore:yr,Compiler:Dn,CharSet:Bn}=Ae(),{RangeMap:Ln,RangeSet:Gn}=Q(),dt=ft(),ee=class{constructor(e={}){if(typeof e=="string")return new ee({fromString:e});let{store:n=new Dn,fromString:r=""}=e,s=Tn(String(r),n.apply.bind(n));Object.defineProperties(this,{store:{value:n},state:{value:s.id},accepts:{value:s.accepts},source:{value:r,enumerable:!0}})}test(e){return this.store.run(this.state,e).accepts}createReducer(){return new mt(this)}},mt=class{constructor(e){Object.defineProperties(this,{_regex:{value:e}}),this.state=e.state,this.accepts=e.accepts}write(e){let n=this._regex.store.run(this.state,e);return this.state=n.id,this.accepts=n.accepts,this}},gt=class{constructor(e,n=new dt.Compiler){this.state=n.compile(e),this.acceps=this.state.accepts,this.store=n}exec(e,n=0){return this.store.run(e,n,this.state).token}};ht.exports={Regex:ee,TokenSet:gt,RangeMap:Ln,RangeSet:Gn,CharSet:Bn,_private:dt}});Object.assign(window,yt());})();
