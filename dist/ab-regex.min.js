(()=>{var C=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports);var $e=C((Fn,Ce)=>{var jn=console.log.bind(console),le=1n,ae=0b1111111111n,gt=~ae,mt=(...e)=>(t,...n)=>[String.raw(...e).replace(/\s+/g,""),le++<<10n|t,...n],yt=()=>["",le++<<10n],xt=()=>le++<<10n,wt=(e={},t=0n)=>new Proxy({},{get:(n,r)=>e[r]||(e[r]=1n<<t++)}),V={},{START:D,END:W,SKIP:ue,CONST:L,LEAF:X,ASSOC:Y,INFIX:pe,PREFIX:z,POSTFIX:fe,GROUP:J}=wt(V),vt=e=>(...t)=>[String.raw(...t).replace(/\s+/g,""),e],[bt,Rt,kt,St,At,It,Ot,_t]=[D,X,L,z,pe,Y,fe,W].map(vt),Ct=e=>{let t=[];for(let n in V)e&V[n]&&t.push(n);return t.join(" | ")};function Pe(e){let t="",n=[],r=new RegExp(e.map(([o,i,...l])=>(n.push([i,...l]),`(${o})`)).join("|"),"ys");r.infos=n,Object.defineProperty(r,"next",{value:s});function s(o,i){this.lastIndex=i;let l=this.exec(o);if(!l)return null;let c=1;for(;l[c]==null;)c++;let[a,...d]=n[c-1];return[a,l[c],...d]}return r}function qt(e){let t={},n={};for(let r in e){let s=e[r],{types:o,lexer:i}=Pt(r,s,e);t[r]=i,n[r]=o}return{lexers:t,sorts:n}}function Pt(e,t,n){let{end:r,skip:s={},sig:o=[]}=t,i=[],l=[],c={};for(let m in s){let S=s[m];i.push([S,ue]),l.push([S,ue])}l.push([r[0],W]);for(let m=0,S=o.length;m<S;m++)for(let A in o[m]){let R=o[m][A],y=xt(),p=0;if(typeof R[0]=="bigint"){let[u,f,h,x]=R;c[A]=y|u|J,p=[f,y|D|u,m,h]}else{let[u,f]=R;c[A]=y|=f,p=[u,y],f&~(X|L)&&(p[2]=m)}p[1]&(z|X|L)?i.push(p):l.push(p)}let a=e,d=Pe(i),g=Pe(l);return{name:a,types:c,lexer:{name:a,Before:d,After:g}}}var j=Symbol("PRE "),qe=Symbol("POST");function jt(e,t,n,r=(...s)=>s){let s,o,i,l,c,a,d,g;return this.parse=A,this;function m(R){let y=new he(t,e[t[3]]);return s=[y],l=0,c=1,a=0,i=R,o=null,d=y.lexer,g=j,y}function S(){let R=g===j?d.Before:d.After,y=R.next(i,l);if(y==null){if(l<i.length&&R.lastIndex<l||g===j)throw new Et(i,l,c,a);return n}else y[1]===`
`&&(c++,a=l+1);return l=R.lastIndex,y}function A(R){for(let y,{ops:p,builds:u}=m(R);;){let f=y||S(),h=y?y[0][0]:f[0],x=h&(X|L|D|ue)?-1:p.length-1;for(;x>=0;x--){let w=p[x],N=typeof w[0]=="bigint"?w:w[0];if(!(h&W||$t(N,f)))break;p.length--;let B=N[3],ie=u.length-B;N.length=2,u[ie]=N[0]&J?r(...w.concat(u.splice(ie,B))):r(w,...u.splice(ie,B))}if(h&W){if(y=s.pop().collapse(f),s.length)({ops:p,builds:u,lexer:d}=s[s.length-1]);else return r(...y);continue}if(h&D){let w=new he(f,e[f[3]]);({ops:p,builds:u,lexer:d}=s[s.length]=w),g=j}else if(h&(X|L))u[u.length]=y?r(...y):r(f),g=qe;else if(p.length&&h&Y&&f[0]===p[p.length-1][0])p[p.length-1][3]++,g=j;else if(h&(z|pe|Y)){p[p.length]=f;let w=h&J?f[0]:f;w[3]=w[0]&z?1:2,g=j}else if(h&fe){let w=u.length-1;h&J?(f[0].length=2,u[w]=r(...f,u[w])):(f.length=2,u[w]=r(f,u[w])),g=qe}y=null}}}var Ee=/([^\n]{0,80})/ys;function Et(e,t,n,r){let s=Math.max(r,t-80);Ee.lastIndex=r;let o=Ee.exec(e)[1];return new SyntaxError(`Invalid expression. At line ${n}:${t-r}:

		${o}
		${"^".padStart(t-r+1)}`)}function $t(e,t){let n=e[2],r=t[2];return n>r?!0:!!(n===r&&n[0]&ae===fe)}var he=class{constructor(t,n){this.opener=t,this.lexer=n,this.ops=[],this.builds=[]}collapse(t){let[n,r,s]=this.opener,o=n&z?1:n&pe|Y?2:0,i=[n&~D|J,r+t[1]];return o&&i.push(s,o),[i,this.builds[0]]}};Ce.exports={compile:qt,opInfo:Ct,Parser:jt,Roles:V,token:mt,tokenType:yt,roleMask:ae,typeMask:gt,start:bt,atom:Rt,konst:kt,prefix:St,infix:At,assoc:It,postfix:Ot,end:_t}});var K=C((Dn,je)=>{var Mn=console.log.bind(console),[de,ge]=[Symbol("Below"),Symbol("Above")],Ft=e=>([t,n],[r,s])=>e(n,s)||(t===r?0:t===de?-1:1),Fe=e=>(t,[n,r])=>e(t,r)||(n===ge?-1:1),me=(e,t,n=cmp)=>{let r=1,s=e.length;for(;r<s&&n(t,e[r])>=0;)r+=2;return e[r-1]},Me=e=>e[Symbol.iterator](),Ne=(e,t)=>function*(r,s,o){s=Me(s),o=Me(o);let{value:i}=s.next(),{value:l}=o.next(),{value:c,done:a}=s.next(),{value:d,done:g}=o.next(),m=r(i,l);for(;!(a&&g);){let S,[A,R]=!a&&g?[c,-1]:a&&!g?[d,1]:(S=e(c,d))>0?[d,1]:[c,S];R<=0&&({value:i}=s.next(),{value:c,done:a}=s.next()),R>=0&&({value:l}=o.next(),{value:d,done:g}=o.next());let y=r(i,l);t(y,m)!==0&&(yield*[m,A],m=y)}yield m};function*Be(e){let t=[],n=e.length-1,r=[-Infinity];for(let s=0;s<n;s+=2){let o=e[s+1];yield{start:r,value:e[s],end:o},r=o}n>=0&&(yield{start:r,value:e[n],end:[Infinity]})}F.above=e=>[ge,e];F.below=e=>[de,e];function F(e,t,{below:n=F.below,above:r=F.above}={}){let s=Ne(Ft(e),t),o=Fe(e);if(typeof e!="function")throw new TypeError("RangeSet class constructor requires compareKey function.");if(typeof t!="function")throw new TypeError("RangeSet class constructor requires compareValue function.");return class{constructor(l){Object.defineProperties(this,{store:{value:Array.from(l),writable:!1,enumerable:!0}})}static constant(l){return new this([l])}static mapped(l,c){return new this(s(l,c.store,[null]))}static merged(l,c,a){return new this(s(l,c.store,a.store))}lookup(l){return me(this.store,l,o)}spans(){return Be(this.store)}}}var Mt=(e,t)=>e?t?0:1:t?-1:0;G.above=e=>[ge,e];G.below=e=>[de,e];function G(e,{below:t=G.below,above:n=G.above}={}){let r=Fe(e);if(typeof e!="function")throw new TypeError("RangeSet class constructor requires compareElement function.");return class extends F(e,Mt){static get top(){return new this([!0])}static get full(){return new this([!0])}static get empty(){return new this([!1])}static fromElement(o){return new this([!1,t(o),!0,n(o),!1])}static fromRange(o,i){return e(o,i)>0?this.empty:new this([!1,t(o),!0,n(i),!1])}static uptoBelow(o){return new this([!0,t(o),!1])}static uptoAbove(o){return new this([!0,n(o),!1])}static fromBelow(o){return new this([!1,t(o),!0])}static fromAbove(o){return new this([!1,n(o),!0])}static not(o){return this.mapped(i=>!i,o)}static and(o,i){return this.merged((l,c)=>l&&c,o,i)}static or(o,i){return this.merged((l,c)=>l||c,o,i)}static diff(o,i){return this.merged((l,c)=>l!==c,o,i)}negate(){return this.constructor.not(this)}test(o){return me(this.store,o,r)}*spans(){for(let{start:o,end:i,value:l}of Be(this.store))l&&(yield{start:o,end:i})}}}je.exports={RangeMap:F,RangeSet:G,_private:{merge:Ne,lookup:me}}});var Q=C((zn,De)=>{var{RangeMap:Ln,RangeSet:Le}=K(),Xn=console.log.bind(console),U=(e,t)=>e<t?-1:e>t?1:0,ye=e=>e.codePointAt(0),Nt=e=>Le.below(e+1),P=Le(U,{above:Nt}),Bt=P.or.bind(P);P.or=(...e)=>e.reduce(Bt);P.range=(e,t)=>P.fromRange(ye(e),ye(t));P.char=e=>P.fromElement(ye(e));P.compare=({store:e},{store:t})=>{let n=U(e.length,t.length)||U(e[0],t[0]);for(let r=1;!n&&r<e.length;r+=2)n=n||U(e[r][1],t[r][1])||U(e[r+1],t[r+1]);return n};De.exports={CharSet:P}});var H=C((Tn,Xe)=>{var T=$e(),{opInfo:Jn,token:Gn,tokenType:Kn,start:Un,atom:_,konst:M,prefix:Dt,infix:Zn,postfix:ee,assoc:Z,end:xe}=T,{LEAF:Lt,CONST:we,PREFIX:Hn,INFIX:Vn,POSTFIX:Wn}=T.Roles,{CharSet:ze}=Q(),{raw:Je}=String,Yn=console.log.bind(console),te=(...e)=>{if(e.length!==2)throw new Error("wrapfix operator definition must use one placeholder");let[t,n]=e[0].raw.map(r=>r.replace(/\s/g,""));return[Lt,t,e[1],n]},Ge={space:Je`[\t \f \x20]+`,newline:Je`[\n]`},Xt={name:"Regex",skip:Ge,end:xe`[)]`,sig:[{any:M`[.]`,top:M`[⊤]`,bottom:M`[⊥]`,empty:M`[ε]`,char:_`[a-zA-Z0-9]`,string:te`["]  ${"Chars"}  "`,nstep:te`\[\^ ${"RangeSet"}  ]`,step:te`[[]  ${"RangeSet"}  ]`,group:te`[(]  ${"Regex"}  )`},{and:Z`[&]`},{or:Z`[|]`},{conc:Z`.{0}(?=[!a-zA-Z0-9."[(⊤⊥ε\t\f\x20\n])`},{not:Dt`[!]`},{star:ee`[*]`,opt:ee`[?]`,plus:ee`[+]`,repeat:ee`<\d+(?:-(?:\d+|[*]))?>`}]},zt={name:"Chars",end:xe`["]`,sig:[{char:_`[^ \x00-\x19 \\"]`,esc:_`[\\] ["/\\bfnrt]`,xesc:_`[\\] x [a-f A-F 0-9]{2}`,hexesc:_`[\\] u [a-f A-F 0-9]{4}`,empty:M`.{0}(?=")`},{strcat:Z`.{0}(?!")`}]},Jt={name:"RangeSet",skip:Ge,end:xe`]`,sig:[{range:_`[^ \x00-\x19 \] ]-[^ \x00-\x19 \] ]`,char:_`[^ \x00-\x19 \\ \]]`,esc:_`[\\] ["/ \\ bfnrt]`,xesc:_`[\\] x [a-f A-F 0-9]{2}`,hexesc:_`[\\] u [a-f A-F 0-9]{4}`,empty:M`.{0}(?=[ \] \t \f \x20 \n ])`},{or:Z`.{0}(?![ \] \t \f \x20 \n ])`}]},{lexers:ve,sorts:k}=T.compile({Regex:Xt,Chars:zt,RangeSet:Jt}),ne=k.Regex,I=k.RangeSet,Qn=I.range|I.char|I.empty|I.or,v={bottom:1,top:1,empty:1,any:1,char:1,step:1,nstep:1,repeat:1,not:1,and:1,or:1,conc:1},re={};for(let e in v)re[v[e]=ne[e]]=e;var oe={};for(let e in I)oe[I[e]]=e;var Kt=(e,t=Gt)=>(...n)=>(n=Ke(...n),n[0]===ne.group?n[1]:n[0]in oe?t(...n):e(...n));function Ut(e,t,n){let r=t==null?Ke:Kt(t,n),s=ve.Regex.Before.next("("),o=ve.Regex.After.next(")");return new T.Parser(ve,s,o,r).parse(e)}var Ue={b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function Ke(...e){let[t,n,r]=e,[s,o]=t;return s===k.Regex.char?[v.char,o]:s===k.Regex.step?[v.step,n]:s===k.Regex.nstep?[v.nstep,n]:s===k.Regex.repeat?Zt(o,n):s===k.Regex.star?[v.repeat,n,0,Infinity]:s===k.Regex.plus?[v.repeat,n,1,Infinity]:s===k.Regex.opt?[v.repeat,n,0,1]:s===k.Regex.group?[ne.group,n]:s===k.Regex.string?[ne.group,n]:s===k.Chars.empty?[v.empty]:s===k.Chars.char?[v.char,o]:s===k.Chars.esc?[v.char,Ue[o[1]]||o[1]]:s===k.Chars.xesc?[v.char,String.fromCodePoint(parseInt(o.substr(2),16))]:s===k.Chars.hexesc?[v.char,String.fromCodePoint(parseInt(o.substr(2),16))]:s===k.Chars.strcat?[v.conc,...e.slice(1)]:s===k.RangeSet.empty?[I.empty]:s===k.RangeSet.range?[I.range,o[0],o[2]]:s===k.RangeSet.char?[I.char,o]:s===k.RangeSet.esc?[I.char,Ue[o[1]]||o[1]]:s===k.RangeSet.xesc?[I.char,String.fromCodePoint(parseInt(o.substr(2),16))]:s===k.RangeSet.hexesc?[I.char,String.fromCodePoint(parseInt(o.substr(2),16))]:s===k.RangeSet.or?[I.or,...e.slice(1)]:(e[0]=s,e)}function Zt(e,t){let[n,r]=e.substr(1,e.length-2).split("-");return n=Math.max(+n,0),r=r==null?n:r==="*"?Infinity:+r,[v.repeat,t,n,r]}var E=(e,t)=>e<t?-1:e>t?1:0,Ht=e=>t=>{let[n,...r]=t;return n&we||n===v.char||n===v.step?t:n===v.repeat?[n,e(r[0]),r[1],r[2]]:[n,...r.map(e)]},Wt=e=>(t,n)=>{let r=t[0],s=n[0],o=E(r,s);if(!o)switch(r){case v.char:return E(t[1],n[1]);case v.range:return E(t[1],n[1])||E(t[2],n[2]);case v.step:return ze.compare(t[1],n[1]);case v.repeat:return e(t[1],n[1])||E(t[2],n[2])||E(t[3],n[3]);default:return Vt(e)(t,n)}return o},Vt=e=>(t,n)=>{let r=E(t.length,n.length);for(let s=1;!r&&s<t.length;s++)r=r||e(t[s],n[s]);return r},Ze=(e,t=re)=>(n,...r)=>{try{let s=t[n];return n&we?e[s]:e[s](...r)}catch(s){let o=`Error in ${e.constructor.name}.apply: `+s.message;throw console.log(o),console.log("Calling",re[n]||n,"on",r,"in Algebra"),console.log(e.constructor.name,e[Symbol.iterator]?[...e]:e),new Error(o)}},Yt=e=>{let t={};for(let n in v){let r=v[n];t[n]=r&we?e(r):(...s)=>e(r,...s)}return t},Qt={fromObject:Ze,fromFunction:Yt},Gt=Ze(ze,oe);Xe.exports={operators:v,operatorNames:re,charSetOpNames:oe,fmap:Ht,compareNode:Wt,parse:Ut,Algebra:Qt}});var ke=C((tr,He)=>{var Tt=(e,t)=>e<t?-1:e>t?1:0,[er,en]=[-1,1],be=q(null,null,0,null,null),Re=class{constructor(t=Tt,n=be){if(typeof t!="function")throw new Error("First argument to AATree must be a comparison function.");this.compare=t,this.store=n}lookup(t){return this.select(t)}select(t){let{compare:n}=this,r=this.store,s=null;for(;r.level;){let o=n(t,r.key);if(s={branch:o,node:r,parent:s},o===0)return new Ve(this,s,r.key);r=o<0?r.l:r.r}return new Ve(this,s,t)}insert(...t){let n=this,r=t.length;for(let s=0;s<r;s+=2)n=n.lookup(t[s]).set(t[s+1]);return n}};function Ve({compare:e},t,n){let r=t!=null&&t.branch===0;this.found=r,this.key=r?t.node.key:n,this.value=r?t.node.value:void 0,this.set=s=>new Re(e,tn(t,n,s))}function q(e,t,n,r,s){return{l:r,level:n,key:e,value:t,r:s}}function nn(e){let{l:t,level:n}=e;return n&&n===t.level?q(t.key,t.value,t.level,t.l,q(e.key,e.value,n,t.r,e.r)):e}function rn(e){let{level:t,r:n}=e;return e.level&&e.level===n.r.level?q(n.key,n.value,n.level+1,q(e.key,e.value,e.level,e.l,n.l),n.r):e}function tn(e,t,n){let r,s;for(e!==null&&e.branch===0?(r=e.node,s=q(t,n,r.level,r.l,r.r),e=e.parent):s=q(t,n,1,be,be);e!==null;)r=e.node,s=e.branch===en?q(r.key,r.value,r.level,r.l,s):q(r.key,r.value,r.level,s,r.r),s=rn(nn(s)),e=e.parent;return s}He.exports=Re});var Ae=C((sr,We)=>{var on=ke(),{fmap:nr,compareNode:sn,operators:b,Algebra:Ye}=H(),se=(e,t)=>e<t?-1:e>t?1:0,rr=console.log.bind(console);function Se(e,t){return cn(e,e(t))}function cn(e,[t,...n]){let[r,s]=n,o=i=>Se(e,i);return t===b.char?r:t===b.any?".":t===b.range?`[${r}-${s}]`:t===b.empty?"\u03B5":t===b.top?"\u22A4":t===b.bottom?"\u22A5":t===b.not?`(!${o(r)})`:t===b.repeat?`(${o(r)}${ln(n[1],n[2])})`:t===b.and?`(${n.map(o).join(" & ")})`:t===b.or?`(${n.map(o).join(" | ")})`:t===b.conc?`(${n.map(o).join("")})`:""}function ln(e,t){return e===0&&t===Infinity?"*":e===1&&t===Infinity?"+":e===0&&t===1?"?":t===Infinity?`<${e}-*>`:`<${e}-${t}>`}function Qe(){let e=r=>this._heap[r],t=(...r)=>{let s=this._memo.select(r);if(s.found)return s.value;let o=this._heap.push(r)-1;return this._memo=s.set(o),o};this._memo=new on(sn(se)),this._heap=[],this.out=e,this.apply=t;function*n(){for(let[r,s]of this._heap.entries())yield[r,Se(e,r),s]}this[Symbol.iterator]=n.bind(this),Object.setPrototypeOf(this,Ye.fromFunction(t))}function an(e=se){return{join:(n,r)=>[...t(n,r)]};function*t(n,r){n=n[Symbol.iterator](),r=r[Symbol.iterator]();let s=n.next(),o=r.next();for(;!(s.done&&o.done);){if(s.done){yield o.value,yield*r;return}if(o.done){yield s.value,yield*n;return}let i=e(s.value,o.value);i<0?(yield s.value,s=n.next()):i>0?(yield o.value,o=r.next()):(yield s.value,[s,o]=[n.next(),r.next()])}}}function un(e){return{join:(n,r)=>[...t(n,r)]};function*t(n,r){let s=0,o=n.length-1;for(;s<o;)yield n[s++];for(yield*e(n[s],r[0]),s=1,o=r.length;s<o;)yield r[s++]}}function pn(e=new Qe){let{top:t,bottom:n,empty:r,any:s}=e,o=(l,c)=>l&&c&&l*c,i=an(se);return new class{constructor(){this._heap=e._heap,this.compare=se;for(let c of["and","or","not","conc","repeat"])this[c]=this[c].bind(this);this.top=t,this.bottom=n,this.empty=r,this.any=s,this.apply=Ye.fromObject(this),this.out=e.out.bind(e),this[Symbol.iterator]=e[Symbol.iterator]}char(...c){return e.char(...c)}step(...c){return e.step(...c)}nstep(...c){return e.nstep(...c)}range(...c){return e.range(...c)}not(c){let[a,d]=e.out(c);return a===b.not?d:e.not(c)}repeat(c,a,d){let[g,m,S,A]=e.out(c);return d===0?r:a===Infinity?n:a===1&&d===1?c:c===s&&a===0&&d===Infinity?t:c===r?r:c===t?t:c===n?n:g===b.repeat?e.repeat(m,o(a,S),o(d,A)):e.repeat(c,a,d)}and(...c){return c.reduce(this.and2.bind(this))}and2(c,a){return c===a?c:c===n||a===n?n:c===t?a:a===t?c[a]=[c,a].sort():e.and(c,a)}or(...c){return c.reduce(this.or2.bind(this))}or2(c,a){let d=this.repeat.bind(this);if(c===t||a===t)return t;if(c===n)return a;if(a===n)return c;if(c===r)return d(a,0,1);if(a===r)return d(c,0,1);let g=A=>{let[R,...y]=e.out(A);return R===b.or||R===b.ors?y:[A]},m=i.join(g(c),g(a));return m.length===1?m[0]:m.length===2?e.apply(b.or,...m):e.apply(b.or,...m)}conc(...c){return c.reduce(this.conc2.bind(this))}conc2(c,a){if(c===n||a===n)return n;if(c===r)return a;if(a===r)return c;let d=S=>{let[A,...R]=e.out(S);return A===b.conc||A===b.concs?R:[S]},g=un(this._squash.bind(this)).join(d(c),d(a));return g.length===1?g[0]:g.length===2?e.apply(b.conc,...g):e.apply(b.conc,...g)}_squash(c,a){let[d,g,m,S]=e.out(c),[A,R,y,p]=e.out(a);return d===b.repeat&&A===b.repeat&&g===R?[e.repeat(g,m+y,S+p)]:c===R&&A===b.repeat?[e.repeat(c,y+1,p+1)]:d===b.repeat&&a===g?[e.repeat(a,m+1,S+1)]:c===a?[e.repeat(c,2,2)]:[c,a]}}}We.exports={Shared:Qe,Normalised:pn,_print:Se}});var _e=C((ar,Te)=>{var{fmap:fn,Algebra:hn,operators:cr,typeNames:dn}=H(),{Normalised:et,_print:gn}=Ae(),{RangeMap:mn,RangeSet:ir}=K(),{CharSet:Ie}=Q(),yn=console.log.bind(console),xn=(e,t)=>e<t?-1:e>t?1:0,Oe=e=>e.codePointAt(0),O={bottom:!1,top:!0,empty:!0,any:!1,step:(...e)=>!1,nstep:(...e)=>!1,char:(...e)=>!1,range:(...e)=>!1,repeat:(e,t,n)=>t===0?!0:e,not:(...e)=>!e[0],or:(...e)=>e.includes(!0),and:(...e)=>!e.includes(!1),conc:(...e)=>!e.includes(!1)};function tt(e=new et){let t=mn(xn,e.compare),n=s=>gn(e.out,s);class r{constructor(o,i,l){this.id=o,this.term=o,this.accepts=i,this.derivs=l}*[Symbol.iterator](){let{id:o,term:i,accepts:l,derivs:c}=this;yield*[o,n(i),l,t.mapped(n,c).store]}}return new class{constructor(){this.bottom=new r(e.bottom,O.bottom,t.constant(e.bottom)),this.top=new r(e.top,O.top,t.constant(e.top)),this.empty=new r(e.empty,O.empty,t.constant(e.bottom)),this.any=new r(e.any,O.any,t.constant(e.empty)),this.apply=hn.fromObject(this),this._heap=e._heap}step(o){return new r(e.step(o),O.step(o),t.mapped(i=>i?e.empty:e.bottom,o))}nstep(o){return new r(e.step(o),O.step(o),t.mapped(i=>i?e.empty:e.bottom,o.negate()))}char(o){return new r(e.char(o),O.char(o),t.mapped(i=>i?e.empty:e.bottom,Ie.fromElement(Oe(o))))}range(o,i){return new r(e.range(o,i),O.range(o,i),t.mapped(l=>l?e.empty:e.bottom,Ie.fromRange(Oe(o),Oe(i))))}not({term:o,accepts:i,derivs:l}){return new r(e.not(o),O.not(i),t.mapped(e.not,l))}repeat({term:o,accepts:i,derivs:l},c,a){let d=e.repeat(o,c,a),g=e.repeat(o,Math.max(c-1,0),Math.max(a-1,0));return new r(d,O.repeat(i,c,a),t.mapped(m=>e.conc(m,g),l))}or(...o){return o.reduce(this.or2.bind(this))}or2(o,i){return new r(e.or(o.term,i.term),O.or(o.accepts,i.accepts),t.merged(e.or,o.derivs,i.derivs))}and(...o){return o.reduce(this.and2.bind(this))}and2(o,i){return new r(e.and(o.term,i.term),O.and(o.accepts,i.accepts),t.merged(e.and,o.derivs,i.derivs))}conc(...o){return o.reduce(this.conc2.bind(this))}conc2(o,i){let l=e.conc(o.term,i.term),c=t.mapped(a=>e.conc(a,i.term),o.derivs);return new r(l,O.conc(o.accepts,i.accepts),o.accepts?t.merged(e.or,c,i.derivs):c)}}}function wn(){let e=new tt,t=e._heap,n=[];this.apply=r.bind(this),this._states=n;for(let s of t)n.push(e.apply(...s));this._inspect=function*(){for(let s of n)yield[...s]};function r(...s){try{let o=n.length-1,i=e.apply(...s);for(n[i.id]=i;o<t.length;o++)if(!n[o]){let l=fn(a=>n[a])(t[o]),c=e.apply(...l);n[c.id]=c}return i}catch(o){let i=`Error in ${this.constructor.name}.apply: `+o.message;console.log(i);let l=s[0],c=s.slice(1);throw console.log("Calling",typeof l=="bigint"?dn[l]:l,"on ",c,"in Algebra"),yn(this._inspect?this._inspect():this),o}}this.run=function(s,o=""){for(let i of o){let l=i.codePointAt(0);if(s===e.bottom.id||s===e.top.id)return n[s];s=n[s].derivs.lookup(l)}return n[s]}}Te.exports={OneLevel:tt,Compiler:wn,Normalised:et,CharSet:Ie}});var lt=C((fr,nt)=>{var vn=ke(),{fmap:bn,Algebra:ur,parse:Rn}=H(),{Normalised:kn}=Ae(),{RangeMap:rt}=K(),{OneLevel:Sn}=_e(),pr=console.log.bind(console),$=(e,t)=>e<t?-1:e>t?1:0,ot=e=>(t,n)=>{let r=$(t.length,n.length),s=1;for(let o=0;!r&&o<t.length;o++)r=r||e(t[o],n[o]);return r},An=([e,t],[n,r])=>$(e,n)||$(t,r),st=ot(An);function In(e,t){let n=[],r=new Set;for(let[s,o]of e)o&&!r.has(o)&&(r.add(o),n.push([s,o]));for(let[s,o]of t)o&&!r.has(o)&&(r.add(o),n.push([s,o]));return n.length?n:[[null,0]]}var ct=rt($,$),it=rt($,st);function On(e=new kn){let t=new Sn(e),n=t._heap,r=new vn(st),s=[],o=[];class i{constructor(u,f){this.accepts=u,this.derivs=f}static fromSpec(u){let f=i.from(null,t.bottom);for(let[h,x]of u){let w=i.from(h,a(x));w.id=u,f=f.add(w)}return f}static from(u,{term:f,accepts:h,derivs:x}){return u=f===0?null:u,x=it.mapped(w=>[[u,w]],x),new i(h?u:null,x)}static merge(u,f){let h=u.accepts==null?f.accepts:u.accepts,x=it.merged(In,u.derivs,f.derivs);return new i(h,x)}add(u){return i.merge(this,u)}}function l(p){return o[p]}function c(p){return m(g(p))}function a(p){for(let u=s.length;u<=p;u=s.length){let f=bn(x=>s[x])(n[u]),h=t.apply(...f);delete h.id,s[h.term]=h}return s[p]}function d(p){let u=r.select(p);if(u.found)return u.value.id;let f=i.fromSpec(p),h=o.push(f)-1;return f.id=h,r=u.set(f),h}function g(p){let u=[],f=new Set;for(let h in p){let x=Rn(p[h],e.apply);f.has(x)||(f.add(x),u.push([h,x]))}return u}function m(p){let u=d(p),f=o[u];f.derivs=ct.mapped(d,f.derivs);for(let h=u+1;h<o.length;h++){let x=o[h];x.derivs=ct.mapped(d,x.derivs)}return u}function S(p,u=0,f=1){let h=o[f],x=h.accepts!=null?[h.accepts,u,u]:null,w=u;for(let B=p.length;w<B;w++)f=h.derivs.lookup(p.charCodeAt(w)),h=o[f],h.accepts!=null&&(x=[h.accepts,u,w+1]);return{token:x?[x[0],p.substring(x[1],x[2])]:null,pos:x?x[2]:w,pos_:w}}function A(){}function*R(){for(let p of o)yield[p.id,p.accepts,String(p.derivs)]}let y=m([[null,0]]);Object.assign(this,{fail:y,states:o,compile:c,get:l,run:S,_inspect:R})}nt.exports={Compiler:On,compare:$,compareArray:ot}});var ht=C((dr,at)=>{var{parse:_n}=H(),{RangeMap:Cn,RangeSet:Pn}=K(),{CharSet:qn}=Q(),{TermStore:hr,Compiler:En}=_e(),ut=lt(),ce=class{constructor(t={}){if(typeof t=="string")return new ce({fromString:t});let{store:n=new En,fromString:r=""}=t,s=_n(String(r),n.apply.bind(n));Object.defineProperties(this,{store:{value:n},state:{value:s.id},accepts:{value:s.accepts},source:{value:r,enumerable:!0}})}test(t){return this.store.run(this.state,t).accepts}createReducer(){return new pt(this)}},pt=class{constructor(t){Object.defineProperties(this,{_regex:{value:t}}),this.state=t.state,this.accepts=t.accepts}write(t){let n=this._regex.store.run(this.state,t);return this.state=n.id,this.accepts=n.accepts,this}},ft=class{constructor(t,n=new ut.Compiler){this.state=n.compile(t),this.acceps=this.state.accepts,this.store=n}exec(t,n=0){return this.store.run(t,n,this.state).token}};at.exports={Regex:ce,TokenSet:ft,RangeMap:Cn,RangeSet:Pn,CharSet:qn,_private:ut}});Object.assign(window,ht());})();
