<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style/base.css">
  <script src="../dist/ab-regex.min.js"></script>

  <style>

    body { font-size:18px; margin:3rem 2rem 2rem;}

    .selected {
      background:teal;
      color:white;
    }
    
    table {
      line-height:1.25rem;
    }

    input {
      width:calc(100% - 5em);
      line-height:1.5rem;
      padding:0 .3em;
    }

    button {
      line-height:1.5rem;
      width:em;
    }

  </style>
</head>

<body class=serif>
<h1>Regular Expression Compiler</h1>
<form>
  <input id=regex><button>Compile</button>
</form>
<div id=table>
</div>

<script>"use strict"

  const leafs = new Set (['td', 'th', 'span', 'del', 'ins', 'input', 'a'])
  const doc = document
  const log = console.log.bind (console)
  const elem = (...args) => (subs) => {
    let tag = String.raw (...args)
    let el = document.createElement (tag)
    if (leafs.has (tag)) el.append (subs)
    else if (subs) el.append (...subs)
    return el
  }

  let pre, button
  let form = doc.forms[0]
  let input = doc.getElementById ('regex')
  let output = doc.getElementById ('table')

  form.addEventListener ('submit', evt => {
    evt.preventDefault ()
    input.blur ()
    show (input.value)
  })
  
  function show (str) {
    try {
      let r = new Regex (String (str))
      let rows = [...r._store].map (row => {
        let { id, term, accepts, derivs } = row
        return elem `tr` ([id, accepts, elem `code` (derivs.toString())].map (elem `td`))
        })
      rows [r.state].classList.add ('selected')

      let table = elem `table` ()
      table.classList.add ('lines')
      table.append (...['state', 'accepts', 'successors'].map (elem `th`))
      table.append (...rows)
      output.innerHTML = null
      output.append (table)
    }
    catch (e) {
      throw e
    }
  }

  input.value = 'a|b|c*'
  show ('a|b|c*')

</script>